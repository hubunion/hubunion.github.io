import{w as _}from"./comlink.bfd883af.js";const B="modulepreload",S=function(e){return"/"+e},p={},f=function(t,n,i){return!n||n.length===0?t():Promise.all(n.map(r=>{if(r=S(r),r in p)return;p[r]=!0;const s=r.endsWith(".css"),o=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${o}`))return;const d=document.createElement("link");if(d.rel=s?"stylesheet":B,s||(d.as="script",d.crossOrigin=""),d.href=r,document.head.appendChild(d),s)return new Promise((c,a)=>{d.addEventListener("load",c),d.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>t())},v=(e,t)=>t.some(n=>e instanceof n);let E,D;function M(){return E||(E=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function P(){return D||(D=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const b=new WeakMap,h=new WeakMap,L=new WeakMap,l=new WeakMap,g=new WeakMap;function k(e){const t=new Promise((n,i)=>{const r=()=>{e.removeEventListener("success",s),e.removeEventListener("error",o)},s=()=>{n(u(e.result)),r()},o=()=>{i(e.error),r()};e.addEventListener("success",s),e.addEventListener("error",o)});return t.then(n=>{n instanceof IDBCursor&&b.set(n,e)}).catch(()=>{}),g.set(t,e),t}function T(e){if(h.has(e))return;const t=new Promise((n,i)=>{const r=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",o),e.removeEventListener("abort",o)},s=()=>{n(),r()},o=()=>{i(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",s),e.addEventListener("error",o),e.addEventListener("abort",o)});h.set(e,t)}let y={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return h.get(e);if(t==="objectStoreNames")return e.objectStoreNames||L.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return u(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function C(e){y=e(y)}function A(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const i=e.call(m(this),t,...n);return L.set(i,t.sort?t.sort():[t]),u(i)}:P().includes(e)?function(...t){return e.apply(m(this),t),u(b.get(this))}:function(...t){return u(e.apply(m(this),t))}}function V(e){return typeof e=="function"?A(e):(e instanceof IDBTransaction&&T(e),v(e,M())?new Proxy(e,y):e)}function u(e){if(e instanceof IDBRequest)return k(e);if(l.has(e))return l.get(e);const t=V(e);return t!==e&&(l.set(e,t),g.set(t,e)),t}const m=e=>g.get(e);function W(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(e,t),d=u(o);return i&&o.addEventListener("upgradeneeded",c=>{i(u(o.result),c.oldVersion,c.newVersion,u(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),d.then(c=>{s&&c.addEventListener("close",()=>s()),r&&c.addEventListener("versionchange",a=>r(a.oldVersion,a.newVersion,a))}).catch(()=>{}),d}const j=["get","getKey","getAll","getAllKeys","count"],O=["put","add","delete","clear"],w=new Map;function I(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=O.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||j.includes(n)))return;const s=async function(o,...d){const c=this.transaction(o,r?"readwrite":"readonly");let a=c.store;return i&&(a=a.index(d.shift())),(await Promise.all([a[n](...d),r&&c.done]))[0]};return w.set(t,s),s}C(e=>({...e,get:(t,n,i)=>I(t,n)||e.get(t,n,i),has:(t,n)=>!!I(t,n)||e.has(t,n)}));"serviceWorker"in navigator&&window.addEventListener("load",async()=>{try{let e;e=await navigator.serviceWorker.register("/service-worker.js"),console.log("Service worker registered! \u{1F60E}",e)}catch(e){console.log("\u{1F625} Service worker registration failed: ",e)}});window.addEventListener("DOMContentLoaded",async()=>{const e=await W("settings-store",1,{upgrade(a){a.createObjectStore("settings")}}),t=new SharedWorker("/assets/worker.095aea1c.js",{type:"module"}),n=_(t.port),{Editor:i}=await f(()=>import("./editor.379a7659.js"),[]),r=new i(document.body),{Menu:s}=await f(()=>import("./menu.0f30bfa7.js"),["assets/menu.0f30bfa7.js","assets/comlink.bfd883af.js"]);new s(document.querySelector(".actions"),r),r.onUpdate(async a=>{await e.put("settings",a,"content"),await n.set(a)});const o="# Welcome to PWA Edit!\n\nTo leave the editing area, press the `esc` key, then `tab` or `shift+tab`.";r.setContent(await e.get("settings","content")||o);const{NightMode:d}=await f(()=>import("./night-mode.b5f4df4b.js"),[]);new d(document.querySelector("#mode"),async a=>{r.setTheme(a),await e.put("settings",a,"night-mode")},await e.get("settings","night-mode"));const{Install:c}=await f(()=>import("./install.77c932ed.js"),[]);new c(document.querySelector("#install"))});export{W as o};
